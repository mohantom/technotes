# MongoDB
- 2020.06.07
- Udemy: MongoDB - The Complete Developer's Guide 2020

[MongoDB Drivers](https://docs.mongodb.com/ecosystem/drivers)
[Official Getting Started Docs](https://docs.mongodb.com/manual/tutorial/getting-started)

[MongoDB Compass](https://docs.mongodb.com/compass/master/install)
[Robo3T GUI client](https://robomongo.org/download)


- database - collections - documents
- schemaless, merge relational data manually
- good for lots of read/write and huge amount of data
- products: enterprise, Atlas, Mobile, Compass, BI connectors, MongoDB charts
    - Stitch: serverless query api, serverless functions, database triggers, real-time sync
- shell uses javascript
    - var dsid = db.patients.findOne().name

```shell script
show dbs
use shop
db.products.insertOne({name: "A book", price: 12.99})
db.products.find().pretty()
```

python driver: `pymongo`
mongo write-through: memory -> db file



## CRUD
mongo stores data as BSON (extension of Json).
"_id": generated by mongo, or can provide in request

### insert, find, update, delete
```shell script
insertOne(data, options)
insertMany(data, options)

find(filter, options)
findOne(filter, options) // return the first match

updateOne(filter, data, options)
updateMany(filter, data, options)
replaceOne(filter, data, options)

deleteOne(filter, options)
deleteMany(filter, options)

```

```shell script
// update record with {distance=12000) with new field "marker"
db.flightData.update({distance: 12000}, {$set: {marker: "delete"}})

db.flightData.updateMany({}, {$set: {marker: "toDelete"}})
db.flightData.deleteMany({marker: "toDelete"})

db.flightData.find({distance: {$gt: 10000}})
```

### updateOne/updateMany vs update
```shell script
// caution: this will replace the whole document!! Use updateOne or updateMany; use replaceOne to replace
db.flightData.update({_id: "test123", {delayed: false})
```

### find & cursor
find() returns cursor object (first 20 records), may not display all results
```shell script
find().toArray()  // show all records
db.flightData.find().forEach(e => printjson(e))  // more efficient, do it one by one like stream
```

### projection
 get only requested fields
```shell script
db.flightData.find({}, {distance: 1, _id: 0}) // only get distance field
```

### embedded documents
up to 100 levels, 16MB/document
```shell script
db.passengers.find({hobbies: "sports"})  // hobbies is an array
db.flightData.find({"status.description": "on-time"})  // need double quotes on key for nested key
```
How to add a new item to the list of a document?








